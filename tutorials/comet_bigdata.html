

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Comet Big Data Tutorial &mdash; cloudmesh_client 4.7.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="cloudmesh_client 4.7.3 documentation" href="../index.html"/>
        <link rel="next" title="API" href="../api.html"/>
        <link rel="prev" title="Comet Cloudmesh Tutorial" href="comet_cloudmesh.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> cloudmesh_client
          

          
          </a>

          
            
            
              <div class="version">
                4.7.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prefix.html">Prefix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">Short Manuals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_card.html">Reference Card</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts.html">Example Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../comet.html">Comet Virtual Cluster</a></li>
</ul>
<p class="caption"><span class="caption-text">User Manuals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../man/man.html">Commands</a></li>
</ul>
<p class="caption"><span class="caption-text">Teaching</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../exercises.html">Exercises</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="comet_cloudmesh.html">Comet Cloudmesh Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Comet Big Data Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#status-of-this-tutorial">Status of this Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparation">Preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sanity-check">Sanity Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deploy-the-stack">Deploy the Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#word-count">Word Count</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-next">What’s next?</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Manuals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hacking.html">Hacking</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix.html">Appendix</a></li>
</ul>
<p class="caption"><span class="caption-text">Future and Old</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stack.html">Stack</a></li>
</ul>
<p class="caption"><span class="caption-text">Code</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code/cloudmesh_client.html">cloudmesh_client package</a></li>
</ul>
<p class="caption"><span class="caption-text">Todo</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../todo.html">ToDos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon.html">Using python 2 and 3 for development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon.html#python-guidelines">Python Guidelines</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cloudmesh_client</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Comet Big Data Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/comet_bigdata.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="comet-big-data-tutorial">
<span id="comet-bigdata"></span><h1>Comet Big Data Tutorial<a class="headerlink" href="#comet-big-data-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">Page Contents</p>
<div class="contents local last topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#status-of-this-tutorial" id="id1">Status of this Tutorial</a></li>
<li><a class="reference internal" href="#overview" id="id2">Overview</a></li>
<li><a class="reference internal" href="#requirements" id="id3">Requirements</a></li>
<li><a class="reference internal" href="#preparation" id="id4">Preparation</a></li>
<li><a class="reference internal" href="#sanity-check" id="id5">Sanity Check</a></li>
<li><a class="reference internal" href="#deploy-the-stack" id="id6">Deploy the Stack</a></li>
<li><a class="reference internal" href="#usage" id="id7">Usage</a></li>
<li><a class="reference internal" href="#word-count" id="id8">Word Count</a></li>
<li><a class="reference internal" href="#what-s-next" id="id9">What’s next?</a></li>
</ul>
</div>
</div>
<p><strong>Goal</strong>: Deploy an analytics cluster and run spark examples.</p>
<p><strong>Time</strong>: ~ 15 min</p>
<div class="section" id="status-of-this-tutorial">
<h2><a class="toc-backref" href="#id1">Status of this Tutorial</a><a class="headerlink" href="#status-of-this-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Released for PEARC17 Comet VC Tutorial</p>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id2">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial you will deploy an analytics stack consisting of
Hadoop and Spark and run some toy analyses on the cluster.</p>
</div>
<div class="section" id="requirements">
<h2><a class="toc-backref" href="#id3">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Basic knowledge of git, shell scripting, and Python.</li>
<li>A Comet cluster<ul>
<li>ip addresses of the nodes</li>
<li>ssh-reachable user with admin privileges</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This tutorial used <cite>vct01</cite> as an example. Please change to your cluster name.</p>
</div>
</div>
<div class="section" id="preparation">
<h2><a class="toc-backref" href="#id4">Preparation</a><a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h2>
<p>On your VC front-end node clone the Big Data Stack repository:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>FE $ git clone --recursive --branch pearc17 git://github.com/futuresystems/big-data-stack
FE $ cd big-data-stack
</pre></div>
</div>
<p>Next create a virtualenvironment and install dependencies:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>FE $ virtualenv ~/BDS
FE $ source ~/BDS/bin/activate
(BDS) FE $ pip install -r requirements.txt
</pre></div>
</div>
<p>The proper interla network interface has been set for this tutorial. For general
case, you may need to configure ansible to use the internal network interface.
Do so by setting the <code class="docutils literal"><span class="pre">bds_internal_iface</span></code> to <code class="docutils literal"><span class="pre">ens3</span></code> in <code class="docutils literal"><span class="pre">group_vars/all.yml</span></code></p>
<p>The ansible remote_user has been set properly for this tutorial assuming you
followed all the previous steps to setup the VC. For general use, please make
sure to configure the authentication. Edit <code class="docutils literal"><span class="pre">ansible.cfg</span></code>
and ensure the following are set in the <code class="docutils literal"><span class="pre">[defaults]</span></code> section:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">remote_user=YOUR_COMPUTE_USERNAME</span></code></li>
<li><code class="docutils literal"><span class="pre">become_ask_pass=True</span></code></li>
</ul>
<p>Finally, generate the ansible inventory file using your cluster IP
addresses. Note, your IP addresses may be different.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>(BDS) FE $ python mk-inventory -n bds- 10.0.0.1 10.0.0.2 &gt;inventory.txt
</pre></div>
</div>
</div>
<div class="section" id="sanity-check">
<h2><a class="toc-backref" href="#id5">Sanity Check</a><a class="headerlink" href="#sanity-check" title="Permalink to this headline">¶</a></h2>
<p>At this point you should be good to go, but make sure that Ansible is
correctly configured by pinging the cluster.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>(BDS) FE $ ansible all -m ping
bds-0 | SUCCESS =&gt; {
  &quot;changed&quot;: false,
  &quot;ping&quot;: &quot;pong&quot;
}
bds-1 | SUCCESS =&gt; {
  &quot;changed&quot;: false,
  &quot;ping&quot;: &quot;pong&quot;
}
</pre></div>
</div>
</div>
<div class="section" id="deploy-the-stack">
<h2><a class="toc-backref" href="#id6">Deploy the Stack</a><a class="headerlink" href="#deploy-the-stack" title="Permalink to this headline">¶</a></h2>
<p>Once you’ve prepared your head node and generated the inventory you
can deploy Hadoop, Spark, and optionally other addons. The addons are
available in the <code class="docutils literal"><span class="pre">addons</span></code> directory, and include packages such as
Apache Drill, HBase, and others. For this tutorial we will only need
Spark.</p>
<p>The following command will deploy Hadoop and Spark using Ansible. This
will take several minutes.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>(BDS) FE $ ansible-playbook -K pearc17.yml
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id7">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Once the stack has been deployed you may log in to the first address
you passed to <code class="docutils literal"><span class="pre">mk-inventory</span></code> and switch to the <code class="docutils literal"><span class="pre">hadoop</span></code> user.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>(BDS) FE $ ssh vm-vct01-00
comet@vm-vct01-00 $ sudo su - hadoop
hadoop@vm-vct01-00 $
</pre></div>
</div>
</div>
<div class="section" id="word-count">
<h2><a class="toc-backref" href="#id8">Word Count</a><a class="headerlink" href="#word-count" title="Permalink to this headline">¶</a></h2>
<p>You can download the complete works for Shakespeare and upload it to
HDFS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>hadoop@vm-vct01-00 $ wget https://raw.githubusercontent.com/cloudmesh/cloudmesh.comet.vcdeploy/master/examples/shakespeare.txt
hadoop@vm-vct01-00 $ hadoop fs -put shakespeare.txt /
</pre></div>
</div>
<p>Next, you can use the following program (adapted from the <a class="reference external" href="https://spark.apache.org/examples.html">Spark
website</a>) to analyze
Shakespeare’s works. The analysis consists of the following steps:</p>
<ol class="arabic simple">
<li>split the text into words</li>
<li>reduce by counting each words</li>
<li>sort the result in descending order</li>
<li>save to results on HDFS</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark</span> <span class="k">import</span> <span class="n">SparkContext</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="p">()</span>

<span class="n">txt</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s1">&#39;hdfs:///shakespeare.txt&#39;</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span> \
            <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">word</span><span class="p">:</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> \
            <span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">sortBy</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">counts</span><span class="o">.</span><span class="n">saveAsTextFile</span><span class="p">(</span><span class="s1">&#39;hdfs:///shakespeare-wordcount.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can download this example by running this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>hadoop@vm-vct01-00 $ wget https://raw.githubusercontent.com/cloudmesh/cloudmesh.comet.vcdeploy/master/examples/spark-shakespeare.py
</pre></div>
</div>
<p>You can run the analysis locally with the following invocation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>hadoop@vm-vct01-00 $ spark-submit spark-shakespeare.py
</pre></div>
</div>
<p>Or you can submit to the cluster by invoking:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>hadoop@vm-vct01-00 $ spark-submit --master yarn --deploy-mode cluster spark-shakespeare.py
</pre></div>
</div>
<p><strong>Make sure to cleanup</strong> before rerunning otherwise the task will fail:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>hadoop@vm-vct01-00 $ hadoop fs -rm -r /shakespeare-wordcount.txt
</pre></div>
</div>
<p>You can then view the top ten words by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>hadoop@vm-vct01-00 $ hadoop fs -cat /shakespeare-wordcount.txt/part-00000 | head
</pre></div>
</div>
</div>
<div class="section" id="what-s-next">
<h2><a class="toc-backref" href="#id9">What’s next?</a><a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Try with a larger data set and compare the performance between local run and cluster run</li>
<li>Try with more sophisticated textual analytics</li>
<li>Deploy other components. This tutorial is tailored specially for the PEARC17 Comet VC tutorial to minimize user intervention and customization while showing the essence of the big data stack deployment. For the general use, please refer to the <a class="reference external" href="https://github.com/futuresystems/big-data-stack">main repo</a>.</li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api.html" class="btn btn-neutral float-right" title="API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="comet_cloudmesh.html" class="btn btn-neutral" title="Comet Cloudmesh Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Gregor von Laszewski.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'4.7.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>